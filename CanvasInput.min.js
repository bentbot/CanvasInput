!function(){var a=[],b=window.CanvasInput=function(b){var c=this;b=b?b:{},c._canvas=b.canvas||null,c._ctx=c._canvas?c._canvas.getContext("2d"):null,c._x=b.x||0,c._y=b.y||0,c._extraX=b.extraX||0,c._extraY=b.extraY||0,c._fontSize=b.fontSize||14,c._fontFamily=b.fontFamily||"Arial",c._fontColor=b.fontColor||"#000",c._placeHolderColor=b.placeHolderColor||"#bfbebd",c._fontWeight=b.fontWeight||"normal",c._fontStyle=b.fontStyle||"normal",c._fontShadowColor=b.fontShadowColor||"",c._fontShadowBlur=b.fontShadowBlur||0,c._fontShadowOffsetX=b.fontShadowOffsetX||0,c._fontShadowOffsetY=b.fontShadowOffsetY||0,c._readonly=b.readonly||!1,c._maxlength=b.maxlength||null,c._width=b.width||150,c._height=b.height||c._fontSize,c._padding=b.padding>=0?b.padding:5,c._borderWidth=b.borderWidth>=0?b.borderWidth:1,c._borderColor=b.borderColor||"#959595",c._borderRadius=b.borderRadius>=0?b.borderRadius:3,c._backgroundImage=b.backgroundImage||"",c._boxShadow=b.boxShadow||"1px 1px 0px rgba(255, 255, 255, 1)",c._innerShadow=b.innerShadow||"0px 0px 4px rgba(0, 0, 0, 0.4)",c._selectionColor=b.selectionColor||"rgba(179, 212, 253, 0.8)",c._cursorColor=b.cursorColor||"#000",c._placeHolder=b.placeHolder||b.placeholder||"",c._value=(b.value||c._placeHolder)+"",c._onsubmit=b.onsubmit||function(){},c._onkeydown=b.onkeydown||function(){},c._onkeyup=b.onkeyup||function(){},c._onfocus=b.onfocus||function(){},c._onblur=b.onblur||function(){},c._cursorPos=b.cursorPos||b.cursorPosition||0,c._cursorWidth=b.cursorWidth||1,c._cursor=b.cursor||b.showCursor||!1,c._selection=b.selection||[0,0],c._hasFocus=!0,c._wasOver=!1,c.boxShadow(c._boxShadow,!0),c._calcWH(),c._renderCanvas=document.createElement("canvas"),c._renderCanvas.setAttribute("width",c.outerW),c._renderCanvas.setAttribute("height",c.outerH),c._renderCtx=c._renderCanvas.getContext("2d"),c._shadowCanvas=document.createElement("canvas"),c._shadowCanvas.setAttribute("width",c._width+2*c._padding),c._shadowCanvas.setAttribute("height",c._height+2*c._padding),c._shadowCtx=c._shadowCanvas.getContext("2d"),"undefined"!=typeof b.backgroundGradient?(c._backgroundColor=c._renderCtx.createLinearGradient(0,0,0,c.outerH),c._backgroundColor.addColorStop(0,b.backgroundGradient[0]),c._backgroundColor.addColorStop(1,b.backgroundGradient[1])):c._backgroundColor=b.backgroundColor||"#fff",c._canvas&&(c._canvas.addEventListener("mousemove",function(a){a=a||window.event,c.mousemove(a,c)},!1),c._canvas.addEventListener("mousedown",function(a){a=a||window.event,c.mousedown(a,c)},!1),c._canvas.addEventListener("mouseup",function(a){a=a||window.event,c.mouseup(a,c)},!1)),window.addEventListener("mouseup",function(a){a=a||window.event,c._hasFocus&&!c._mouseDown&&c.blur()},!0),c._hiddenInput=document.createElement("input"),c._hiddenInput.type="text",c._hiddenInput.style.position="absolute",c._hiddenInput.style.opacity=0,c._hiddenInput.style.pointerEvents="none",c._hiddenInput.style.left=c._x+c._extraX+(c._canvas?c._canvas.offsetLeft:0)+"px",c._hiddenInput.style.top=c._y+c._extraY+(c._canvas?c._canvas.offsetTop:0)+"px",c._hiddenInput.style.width=c._width+"px",c._hiddenInput.style.height=c._height+"px",c._hiddenInput.style.zIndex=0,c._maxlength&&(c._hiddenInput.maxLength=c._maxlength),document.body.appendChild(c._hiddenInput),c._hiddenInput.value=c._value,c._hiddenInput.addEventListener("keydown",function(a){a=a||window.event,c._hasFocus&&c.keydown(a,c)}),c._hiddenInput.addEventListener("keyup",function(a){a=a||window.event,c._value=c._hiddenInput.value,c._cursorPos=c._hiddenInput.selectionEnd,c._cursor=!1,c._selection=[c._hiddenInput.selectionStart,c._hiddenInput.selectionEnd],c.render(),c._hasFocus&&c._onkeyup(a,c)}),a.push(c),c._inputsIndex=a.length-1,c.render()};b.prototype={canvas:function(a){var b=this;return"undefined"!=typeof a?(b._canvas=a,b._ctx=b._canvas.getContext("2d"),b.render()):b._canvas},x:function(a){var b=this;return"undefined"!=typeof a?(b._x=a,b.render()):b._x},y:function(a){var b=this;return"undefined"!=typeof a?(b._y=a,b.render()):b._y},extraX:function(a){var b=this;return"undefined"!=typeof a?(b._extraX=a,b.render()):b._extraX},extraY:function(a){var b=this;return"undefined"!=typeof a?(b._extraY=a,b.render()):b._extraY},fontSize:function(a){var b=this;return"undefined"!=typeof a?(b._fontSize=a,b.render()):b._fontSize},fontFamily:function(a){var b=this;return"undefined"!=typeof a?(b._fontFamily=a,b.render()):b._fontFamily},fontColor:function(a){var b=this;return"undefined"!=typeof a?(b._fontColor=a,b.render()):b._fontColor},placeHolderColor:function(a){var b=this;return"undefined"!=typeof a?(b._placeHolderColor=a,b.render()):b._placeHolderColor},fontWeight:function(a){var b=this;return"undefined"!=typeof a?(b._fontWeight=a,b.render()):b._fontWeight},fontStyle:function(a){var b=this;return"undefined"!=typeof a?(b._fontStyle=a,b.render()):b._fontStyle},fontShadowColor:function(a){var b=this;return"undefined"!=typeof a?(b._fontShadowColor=a,b.render()):b._fontShadowColor},fontShadowBlur:function(a){var b=this;return"undefined"!=typeof a?(b._fontShadowBlur=a,b.render()):b._fontShadowBlur},fontShadowOffsetX:function(a){var b=this;return"undefined"!=typeof a?(b._fontShadowOffsetX=a,b.render()):b._fontShadowOffsetX},fontShadowOffsetY:function(a){var b=this;return"undefined"!=typeof a?(b._fontShadowOffsetY=a,b.render()):b._fontShadowOffsetY},width:function(a){var b=this;return"undefined"!=typeof a?(b._width=a,b._calcWH(),b._updateCanvasWH(),b.render()):b._width},height:function(a){var b=this;return"undefined"!=typeof a?(b._height=a,b._calcWH(),b._updateCanvasWH(),b.render()):b._height},padding:function(a){var b=this;return"undefined"!=typeof a?(b._padding=a,b._calcWH(),b._updateCanvasWH(),b.render()):b._padding},borderWidth:function(a){var b=this;return"undefined"!=typeof a?(b._borderWidth=a,b._calcWH(),b._updateCanvasWH(),b.render()):b._borderWidth},borderColor:function(a){var b=this;return"undefined"!=typeof a?(b._borderColor=a,b.render()):b._borderColor},borderRadius:function(a){var b=this;return"undefined"!=typeof a?(b._borderRadius=a,b.render()):b._borderRadius},backgroundColor:function(a){var b=this;return"undefined"!=typeof a?(b._backgroundColor=a,b.render()):b._backgroundColor},backgroundGradient:function(a){var b=this;return"undefined"!=typeof a?(b._backgroundColor=b._renderCtx.createLinearGradient(0,0,0,b.outerH),b._backgroundColor.addColorStop(0,a[0]),b._backgroundColor.addColorStop(1,a[1]),b.render()):b._backgroundColor},boxShadow:function(a,b){var c=this;if("undefined"==typeof a)return c._boxShadow;var d=a.split("px ");return c._boxShadow={x:"none"===c._boxShadow?0:parseInt(d[0],10),y:"none"===c._boxShadow?0:parseInt(d[1],10),blur:"none"===c._boxShadow?0:parseInt(d[2],10),color:"none"===c._boxShadow?"":d[3]},c._boxShadow.x<0?(c.shadowL=Math.abs(c._boxShadow.x)+c._boxShadow.blur,c.shadowR=c._boxShadow.blur+c._boxShadow.x):(c.shadowL=Math.abs(c._boxShadow.blur-c._boxShadow.x),c.shadowR=c._boxShadow.blur+c._boxShadow.x),c._boxShadow.y<0?(c.shadowT=Math.abs(c._boxShadow.y)+c._boxShadow.blur,c.shadowB=c._boxShadow.blur+c._boxShadow.y):(c.shadowT=Math.abs(c._boxShadow.blur-c._boxShadow.y),c.shadowB=c._boxShadow.blur+c._boxShadow.y),c.shadowW=c.shadowL+c.shadowR,c.shadowH=c.shadowT+c.shadowB,c._calcWH(),b?void 0:(c._updateCanvasWH(),c.render())},innerShadow:function(a){var b=this;return"undefined"!=typeof a?(b._innerShadow=a,b.render()):b._innerShadow},selectionColor:function(a){var b=this;return"undefined"!=typeof a?(b._selectionColor=a,b.render()):b._selectionColor},placeHolder:function(a){var b=this;return"undefined"!=typeof a?(b._placeHolder=a,b.render()):b._placeHolder},value:function(a){var b=this;return"undefined"!=typeof a?(b._value=a+"",b._hiddenInput.value=a+"",b._cursorPos=b._clipText().length,b.render(),b):b._value===b._placeHolder?"":b._value},onsubmit:function(a){var b=this;return"undefined"!=typeof a?(b._onsubmit=a,b):void b._onsubmit()},onkeydown:function(a){var b=this;return"undefined"!=typeof a?(b._onkeydown=a,b):void b._onkeydown()},onkeyup:function(a){var b=this;return"undefined"!=typeof a?(b._onkeyup=a,b):void b._onkeyup()},focus:function(b){var c=this;if(!c._hasFocus){c._onfocus(c);for(var d=0;d<a.length;d++)a[d]._hasFocus&&a[d].blur()}c._selectionUpdated?delete c._selectionUpdated:c._selection=[0,0],c._hasFocus=!0,c._readonly?c._hiddenInput.readOnly=!0:(c._hiddenInput.readOnly=!1,c._cursorPos="number"==typeof b?b:c._clipText().length,c._placeHolder===c._value&&(c._value="",c._hiddenInput.value=""),c._cursor=!0,c._cursorInterval&&clearInterval(c._cursorInterval),c._cursorInterval=setInterval(function(){c._cursor=!c._cursor,c.render()},500));var e=c._selection[0]>0||c._selection[1]>0;return c._hiddenInput.focus(),c._hiddenInput.selectionStart=e?c._selection[0]:c._cursorPos,c._hiddenInput.selectionEnd=e?c._selection[1]:c._cursorPos,c.render()},blur:function(a){var b=a||this;return b._onblur(b),b._cursorInterval&&clearInterval(b._cursorInterval),b._hasFocus=!1,b._cursor=!1,b._selection=[0,0],b._hiddenInput.blur(),""===b._value&&(b._value=b._placeHolder),b.render()},keydown:function(b,c){var d=b.which;b.shiftKey;if(!c._readonly&&c._hasFocus){if(c._onkeydown(b,c),65===d&&(b.ctrlKey||b.metaKey))return c.selectText(),b.preventDefault(),c.render();if(17===d||b.metaKey||b.ctrlKey)return c;if(13===d)b.preventDefault(),c._onsubmit(b,c);else if(9===d&&(b.preventDefault(),a.length>1)){var e=a[c._inputsIndex+1]?c._inputsIndex+1:0;c.blur(),setTimeout(function(){a[e].focus()},10)}return c._value=c._hiddenInput.value,c._cursorPos=c._hiddenInput.selectionStart,c._selection=[0,0],c.render()}},click:function(a,b){var c=b._mousePos(a),d=c.x,e=c.y;return b._endSelection?(delete b._endSelection,void delete b._selectionUpdated):b._canvas&&b._overInput(d,e)||!b._canvas?b._mouseDown?(b._mouseDown=!1,b.click(a,b),b.focus(b._clickPos(d,e))):void 0:b.blur()},mousemove:function(a,b){var c=b._mousePos(a),d=c.x,e=c.y,f=b._overInput(d,e);if(f&&b._canvas?(b._canvas.style.cursor="text",b._wasOver=!0):b._wasOver&&b._canvas&&(b._canvas.style.cursor="default",b._wasOver=!1),b._hasFocus&&b._selectionStart>=0){var g=b._clickPos(d,e),h=Math.min(b._selectionStart,g),i=Math.max(b._selectionStart,g);if(!f)return b._selectionUpdated=!0,b._endSelection=!0,delete b._selectionStart,void b.render();(b._selection[0]!==h||b._selection[1]!==i)&&(b._selection=[h,i],b.render())}},mousedown:function(a,b){var c=b._mousePos(a),d=c.x,e=c.y,f=b._overInput(d,e);b._mouseDown=f,b._hasFocus&&f&&(b._selectionStart=b._clickPos(d,e))},mouseup:function(a,b){var c=b._mousePos(a),d=c.x,e=c.y,f=b._clickPos(d,e)!==b._selectionStart;b._hasFocus&&b._selectionStart>=0&&b._overInput(d,e)&&f?(b._selectionUpdated=!0,delete b._selectionStart,b.render()):delete b._selectionStart,b.click(a,b)},selectText:function(a){var b=this,a=a||[0,b._value.length];return setTimeout(function(){b._selection=[a[0],a[1]],b._hiddenInput.selectionStart=a[0],b._hiddenInput.selectionEnd=a[1],b.render()},1),b},renderCanvas:function(){return this._renderCanvas},render:function(){var a=this,b=a._renderCtx,c=a.outerW,d=a.outerH,e=a._borderRadius,f=a._borderWidth,g=a.shadowW,h=a.shadowH;b&&(b.clearRect(0,0,b.canvas.width,b.canvas.height),b.shadowOffsetX=a._boxShadow.x,b.shadowOffsetY=a._boxShadow.y,b.shadowBlur=a._boxShadow.blur,b.shadowColor=a._boxShadow.color,a._borderWidth>0&&(b.fillStyle=a._borderColor,a._roundedRect(b,a.shadowL,a.shadowT,c-g,d-h,e),b.fill(),b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=0),a._drawTextBox(function(){b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=0;var i=a._clipText(),j=a._padding+a._borderWidth+a.shadowT;if(a._selection[1]>0){var k=a._textWidth(i.substring(0,a._selection[0])),l=a._textWidth(i.substring(a._selection[0],a._selection[1]));b.fillStyle=a._selectionColor,b.fillRect(j+k,j,l,a._height)}if(a._cursor){var m=a._textWidth(i.substring(0,a._cursorPos));b.fillStyle=a._cursorColor,b.fillRect(j+m,j,a._cursorWidth,a._height)}var n=a._padding+a._borderWidth+a.shadowL,o=Math.round(j+a._height/2);i=""===i&&a._placeHolder?a._placeHolder:i,b.fillStyle=""!==a._value&&a._value!==a._placeHolder?a._fontColor:a._placeHolderColor,b.font=a._fontStyle+" "+a._fontWeight+" "+a._fontSize+"px "+a._fontFamily,b.shadowColor=a._fontShadowColor,b.shadowBlur=a._fontShadowBlur,b.shadowOffsetX=a._fontShadowOffsetX,b.shadowOffsetY=a._fontShadowOffsetY,b.textAlign="left",b.textBaseline="middle",b.fillText(i,n,o);var p=a._innerShadow.split("px "),q="none"===a._innerShadow?0:parseInt(p[0],10),r="none"===a._innerShadow?0:parseInt(p[1],10),s="none"===a._innerShadow?0:parseInt(p[2],10),t="none"===a._innerShadow?"":p[3];if(s>0){var u=a._shadowCtx,v=u.canvas.width,w=u.canvas.height;u.clearRect(0,0,v,w),u.shadowBlur=s,u.shadowColor=t,u.shadowOffsetX=0,u.shadowOffsetY=r,u.fillRect(-1*c,-100,3*c,100),u.shadowOffsetX=q,u.shadowOffsetY=0,u.fillRect(v,-1*d,100,3*d),u.shadowOffsetX=0,u.shadowOffsetY=r,u.fillRect(-1*c,w,3*c,100),u.shadowOffsetX=q,u.shadowOffsetY=0,u.fillRect(-100,-1*d,100,3*d),a._roundedRect(b,f+a.shadowL,f+a.shadowT,c-2*f-g,d-2*f-h,e),b.clip(),b.drawImage(a._shadowCanvas,0,0,v,w,f+a.shadowL,f+a.shadowT,v,w)}return a._ctx&&(a._ctx.clearRect(a._x,a._y,b.canvas.width,b.canvas.height),a._ctx.drawImage(a._renderCanvas,a._x,a._y)),a}))},destroy:function(){var b=this,c=a.indexOf(b);-1!=c&&a.splice(c,1),b._hasFocus&&b.blur(),document.body.removeChild(b._hiddenInput),b._renderCanvas=null,b._shadowCanvas=null,b._renderCtx=null},_drawTextBox:function(a){var b=this,c=b._renderCtx,d=b.outerW,e=b.outerH,f=b._borderRadius,g=b._borderWidth,h=b.shadowW,i=b.shadowH;if(""===b._backgroundImage)c.fillStyle=b._backgroundColor,b._roundedRect(c,g+b.shadowL,g+b.shadowT,d-2*g-h,e-2*g-i,f),c.fill(),a();else{var j=new Image;j.src=b._backgroundImage,j.onload=function(){c.drawImage(j,0,0,j.width,j.height,g+b.shadowL,g+b.shadowT,d,e),a()}}},_clearSelection:function(){var a=this;if(a._selection[1]>0){var b=a._selection[0],c=a._selection[1];return a._value=a._value.substr(0,b)+a._value.substr(c),a._cursorPos=b,a._cursorPos=a._cursorPos<0?0:a._cursorPos,a._selection=[0,0],!0}return!1},_clipText:function(a){var b=this;a="undefined"==typeof a?b._value:a;var c=b._textWidth(a),d=c/(b._width-b._padding),e=d>1?a.substr(-1*Math.floor(a.length/d)):a;return e+""},_textWidth:function(a){var b=this,c=b._renderCtx;return c.font=b._fontStyle+" "+b._fontWeight+" "+b._fontSize+"px "+b._fontFamily,c.textAlign="left",c.measureText(a).width},_calcWH:function(){var a=this;a.outerW=a._width+2*a._padding+2*a._borderWidth+a.shadowW,a.outerH=a._height+2*a._padding+2*a._borderWidth+a.shadowH},_updateCanvasWH:function(){var a=this,b=a._renderCanvas.width,c=a._renderCanvas.height;a._renderCanvas.setAttribute("width",a.outerW),a._renderCanvas.setAttribute("height",a.outerH),a._shadowCanvas.setAttribute("width",a._width+2*a._padding),a._shadowCanvas.setAttribute("height",a._height+2*a._padding),a._ctx&&a._ctx.clearRect(a._x,a._y,b,c)},_roundedRect:function(a,b,c,d,e,f){2*f>d&&(f=d/2),2*f>e&&(f=e/2),a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath()},_overInput:function(a,b){var c=this,d=a>=c._x+c._extraX,e=a<=c._x+c._extraX+c._width+2*c._padding,f=b>=c._y+c._extraY,g=b<=c._y+c._extraY+c._height+2*c._padding;return d&&e&&f&&g},_clickPos:function(a,b){var c=this,d=c._value;c._value===c._placeHolder&&(d="");var e=c._clipText(d),f=0,g=e.length;if(a-(c._x+c._extraX)<c._textWidth(e))for(var h=0;h<e.length;h++)if(f+=c._textWidth(e[h]),f>=a-(c._x+c._extraX)){g=h;break}return g},_mousePos:function(a){var b=a.target,c=document.defaultView.getComputedStyle(b,void 0),d=parseInt(c.paddingLeft,10)||0,e=parseInt(c.paddingLeft,10)||0,f=parseInt(c.borderLeftWidth,10)||0,g=parseInt(c.borderLeftWidth,10)||0,h=document.body.parentNode.offsetTop||0,i=document.body.parentNode.offsetLeft||0,j=0,k=0;if("undefined"!=typeof b.offsetParent)do j+=b.offsetLeft,k+=b.offsetTop;while(b=b.offsetParent);return j+=d+f+i,k+=e+g+h,{x:a.pageX-j,y:a.pageY-k}}}}();